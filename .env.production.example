# ConformAI Production Environment Configuration
# Copy this file to .env and update with your actual values

# =============================================================================
# ENVIRONMENT
# =============================================================================
ENVIRONMENT=production
DEBUG=false
LOG_LEVEL=INFO
LOG_FORMAT=json

# =============================================================================
# SECURITY & AUTHENTICATION
# =============================================================================

# API Authentication (IMPORTANT: Enable for production!)
API_KEYS_ENABLED=true
API_KEYS=your_production_key_here,your_backup_key_here  # Comma-separated, min 32 chars each

# API Key Header (default is X-API-Key, change if needed)
API_KEY_HEADER=X-API-Key

# JWT Configuration (for future user authentication)
JWT_SECRET_KEY=your-strong-random-secret-key-min-32-chars
JWT_ALGORITHM=HS256
JWT_EXPIRATION_MINUTES=60

# =============================================================================
# RATE LIMITING
# =============================================================================

# Requests per minute per API key
RATE_LIMIT_PER_MINUTE=60

# Requests per hour per API key
RATE_LIMIT_PER_HOUR=1000

# =============================================================================
# LLM API KEYS (REQUIRED)
# =============================================================================

# Anthropic API Key (for Claude models)
ANTHROPIC_API_KEY=sk-ant-api03-your-key-here

# OpenAI API Key (for embeddings and GPT models)
OPENAI_API_KEY=sk-your-openai-key-here

# =============================================================================
# OBSERVABILITY
# =============================================================================

# Opik (Comet) Configuration
OPIK_ENABLED=true
OPIK_API_KEY=your-opik-api-key
COMET_WORKSPACE=your-workspace-name
OPIK_PROJECT_NAME=conformai-production
OPIK_URL=https://www.comet.com/api

# =============================================================================
# DATABASES
# =============================================================================

# PostgreSQL
POSTGRES_USER=conformai
POSTGRES_PASSWORD=your-strong-postgres-password
POSTGRES_DB=conformai
POSTGRES_HOST=postgres
POSTGRES_PORT=5432
DATABASE_URL=postgresql://conformai:your-strong-postgres-password@postgres:5432/conformai

# Qdrant Vector Database
QDRANT_HOST=qdrant
QDRANT_PORT=6333
QDRANT_URL=http://qdrant:6333
QDRANT_API_KEY=  # Optional, leave empty for local deployment

# Redis (for rate limiting and caching)
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_DB=0
REDIS_URL=redis://redis:6379/0

# =============================================================================
# LLM CONFIGURATION
# =============================================================================

# Provider: anthropic or openai
LLM_PROVIDER=anthropic

# Model name
LLM_MODEL=claude-3-5-sonnet-20241022

# Generation parameters
LLM_TEMPERATURE=0.1
LLM_MAX_TOKENS=4096

# =============================================================================
# EMBEDDINGS
# =============================================================================

EMBEDDING_PROVIDER=openai
EMBEDDING_MODEL=text-embedding-3-large
EMBEDDING_DIMENSION=1024
EMBEDDING_DEVICE=cpu

# =============================================================================
# RETRIEVAL CONFIGURATION
# =============================================================================

RETRIEVAL_TOP_K=10
RETRIEVAL_FETCH_K=20
RETRIEVAL_MMR_LAMBDA=0.5
RETRIEVAL_MIN_CONFIDENCE=0.3

# =============================================================================
# DOCUMENT PROCESSING
# =============================================================================

CHUNK_SIZE=1000
CHUNK_OVERLAP=200
MAX_ARTICLE_LENGTH=50000

# =============================================================================
# DATA SOURCES
# =============================================================================

# EUR-Lex API
EURLEX_API_BASE_URL=https://eur-lex.europa.eu

# European Data Protection Board
EDPB_RSS_URL=https://edpb.europa.eu/rss/all_en.xml

# =============================================================================
# OBJECT STORAGE (S3/MinIO)
# =============================================================================

S3_ENDPOINT_URL=http://minio:9000
S3_ACCESS_KEY=minioadmin
S3_SECRET_KEY=minioadmin
S3_BUCKET_NAME=conformai-documents

# =============================================================================
# API SERVICES
# =============================================================================

# API Gateway
API_HOST=0.0.0.0
API_PORT=8000
API_RELOAD=false
API_WORKERS=4

# RAG Service
RAG_SERVICE_HOST=rag-service
RAG_SERVICE_PORT=8001

# Retrieval Service
RETRIEVAL_SERVICE_HOST=retrieval-service
RETRIEVAL_SERVICE_PORT=8002

# =============================================================================
# MONITORING
# =============================================================================

# Prometheus
PROMETHEUS_PORT=9090

# Grafana
GRAFANA_PORT=3000

# =============================================================================
# EMAIL ALERTS (for Airflow notifications)
# =============================================================================

SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your-email@gmail.com
SMTP_PASSWORD=your-app-specific-password
ALERT_EMAIL=alerts@yourcompany.com

# =============================================================================
# NOTES
# =============================================================================

# Security Checklist:
# [ ] Change all default passwords
# [ ] Generate strong JWT secret key (min 32 chars)
# [ ] Create strong API keys (min 32 chars, random)
# [ ] Configure email alerts
# [ ] Enable Opik monitoring
# [ ] Set appropriate rate limits
# [ ] Review and update all API keys
# [ ] Set API_KEYS_ENABLED=true
# [ ] Enable HTTPS in production
# [ ] Configure firewall rules
# [ ] Set up SSL certificates
# [ ] Configure backup strategy

# Monitoring Checklist:
# [ ] Verify Opik integration
# [ ] Set up Prometheus scraping
# [ ] Configure Grafana dashboards
# [ ] Test health check endpoints
# [ ] Verify error logging
# [ ] Set up alert rules
# [ ] Configure uptime monitoring

# Performance Tuning:
# - Adjust API_WORKERS based on CPU cores (2-4 per core)
# - Increase RATE_LIMIT_* for high-traffic scenarios
# - Adjust RETRIEVAL_TOP_K based on quality vs speed tradeoff
# - Monitor memory usage and adjust CHUNK_SIZE if needed
# - Consider Redis cluster for high availability
# - Use managed Qdrant for production (Qdrant Cloud)

# High Availability:
# - Deploy multiple instances behind load balancer
# - Use managed PostgreSQL (RDS, Cloud SQL)
# - Use Redis Cluster or managed Redis
# - Use Qdrant Cloud or replicated Qdrant
# - Set up automatic failover
# - Configure health checks in load balancer
# - Enable auto-scaling based on metrics

# Backup Strategy:
# - Daily Qdrant backups to S3
# - Daily PostgreSQL backups
# - Backup embedding files
# - Test restore procedure monthly
# - Keep 30 days of backups
# - Document recovery procedures
